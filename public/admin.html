<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>관리자 인증</title>
  <style>
    body { font-family: Arial; text-align: center; padding-top: 50px; background: #f5f7fa; }
    .box {
      background: white; padding: 30px; width: 90%; max-width: 400px;
      margin: auto; border-radius: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    button {
      width: 100%; padding: 15px; font-size: 16px; background: #2b4b8b;
      color: white; border: none; border-radius: 10px; font-weight: bold;
    }
    button:active { background: #1f3766; }
    #msg { margin-top: 15px; font-size: 15px; }
  </style>
</head>

<body>
  <div class="box">
    <h2>관리자 인증</h2>
    <p>메타마스크로 로그인하세요.</p>

    <button onclick="login()">메타마스크로 로그인</button>

    <p id="msg"></p>
  </div>

  <script>
    async function login() {
      const msgBox = document.getElementById("msg");

      if (!window.ethereum) {
        msgBox.innerText = "메타마스크가 설치되어 있지 않습니다.";
        return;
      }

      try {
        // ① 계정 요청
        const accounts = await ethereum.request({ method: "eth_requestAccounts" });
        const wallet = accounts[0];

        // ② 서버가 서명하게 할 메시지 (nonce 방식이 일반적이지만 간단히 구현)
        const message = "INU Admin Login Verification";

        // ③ 메시지 서명
        const signature = await ethereum.request({
          method: "personal_sign",
          params: [message, wallet]
        });

        msgBox.innerText = "서명 완료, 인증 중...";

        // ④ 서버로 서명 전달
        const res = await fetch("/api/admin/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message, signature })
        });

        const data = await res.json();

        if (data.success) {
          msgBox.style.color = "green";
          msgBox.innerText = "관리자 인증 성공! 이동합니다...";
          setTimeout(() => location.href = "/adminview.html", 700);
        } else {
          msgBox.style.color = "red";
          msgBox.innerText = "관리자 인증 실패";
        }

      } catch (err) {
        msgBox.innerText = "오류: " + err.message;
      }
    }
  </script>
</body>
</html>
